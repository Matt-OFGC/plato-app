generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ActivityLog {
  id         Int      @id @default(autoincrement())
  createdAt  DateTime @default(now())
  userId     Int
  companyId  Int
  action     String
  entity     String
  entityId   Int?
  entityName String?
  details    Json?
  ipAddress  String?
  userAgent  String?
  Company    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId, createdAt])
  @@index([companyId])
  @@index([entity, entityId])
  @@index([userId])
}

model AllergenSheetTemplate {
  id                     Int      @id @default(autoincrement())
  createdAt              DateTime @default(now())
  updatedAt              DateTime
  companyId              Int?
  templateName           String
  templateType           String   @default("custom")
  sheetStyle             String   @default("full_detail")
  backgroundColor        String   @default("#FFFFFF")
  textColor              String   @default("#000000")
  headingColor           String   @default("#2D3142")
  warningColor           String   @default("#FF6B6B")
  headingFont            String   @default("Poppins")
  headingSize            Int      @default(24)
  bodyFont               String   @default("Poppins")
  bodySize               Int      @default(11)
  pageMarginsMm          Decimal  @default(15.0)
  showFullIngredients    Boolean  @default(true)
  showAllergenList       Boolean  @default(true)
  showDietarySuitability Boolean  @default(true)
  showStorageInfo        Boolean  @default(true)
  showWeight             Boolean  @default(true)
  showBestBefore         Boolean  @default(true)
  showCompanyDetails     Boolean  @default(true)
  showContactInfo        Boolean  @default(true)
  showLastUpdated        Boolean  @default(true)
  isDefault              Boolean  @default(false)
  isSystemTemplate       Boolean  @default(false)
  createdBy              Int?
  Company                Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([companyId, isSystemTemplate])
}

model Category {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  name        String
  description String?
  color       String?
  order       Int      @default(0)
  companyId   Int?
  Company     Company? @relation(fields: [companyId], references: [id])
  Recipe      Recipe[]

  @@unique([name, companyId])
  @@index([companyId])
  @@index([companyId, order])
}

model Company {
  id                    Int                     @id @default(autoincrement())
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  name                  String
  address               String?
  businessType          String?
  city                  String?
  country               String                  @default("United Kingdom")
  email                 String?
  isProfilePublic       Boolean                 @default(false)
  logoUrl               String?
  maxSeats              Int                     @default(5)
  ownerId               Int?
  phone                 String?
  postcode              String?
  pricePerSeat          Decimal                 @default(5.00)
  profileBio            String?
  seatsUsed             Int                     @default(1)
  showContact           Boolean                 @default(true)
  showTeam              Boolean                 @default(false)
  slug                  String?                 @unique
  website               String?
  ActivityLog           ActivityLog[]
  AllergenSheetTemplate AllergenSheetTemplate[]
  Category              Category[]
  GeneratedDocument     GeneratedDocument[]
  Ingredient            Ingredient[]
  LabelTemplate         LabelTemplate[]
  Membership            Membership[]
  ProductionHistory     ProductionHistory[]
  ProductionPlan        ProductionPlan[]
  Recipe                Recipe[]
  RecipeUpdateLog       RecipeUpdateLog[]
  SalesRecord           SalesRecord[]
  SeasonalTrend         SeasonalTrend[]
  ShelfLifeOption       ShelfLifeOption[]
  StorageOption         StorageOption[]
  Supplier              Supplier[]
  TeamInvitation        TeamInvitation[]
  WholesaleCustomer     WholesaleCustomer[]
  WholesaleDeliveryNote WholesaleDeliveryNote[]
  WholesaleInvoice      WholesaleInvoice[]
  WholesaleOrder        WholesaleOrder[]
  WholesalePayment      WholesalePayment[]
  WholesaleProduct      WholesaleProduct[]

  customReports CustomReport[]
}

model CustomReport {
  id                Int       @id @default(autoincrement())
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  companyId         Int
  createdBy         Int
  name              String
  description       String?
  reportType        String
  metrics           Json
  filters           Json?
  grouping          Json?
  dateRange         Json?
  isScheduled       Boolean   @default(false)
  scheduleFrequency String?
  scheduleTime      String?
  exportFormats     String[]  @default([])
  emailRecipients   String[]  @default([])
  isActive          Boolean   @default(true)
  lastRunAt         DateTime?
  Company           Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, name])
  @@index([companyId])
  @@index([createdBy])
  @@index([isScheduled])
}

model CustomerPricing {
  id                Int               @id @default(autoincrement())
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  customerId        Int
  recipeId          Int
  price             Decimal
  unit              String            @default("each")
  notes             String?
  WholesaleCustomer WholesaleCustomer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  Recipe            Recipe            @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@unique([customerId, recipeId])
  @@index([customerId])
  @@index([recipeId])
}

model GeneratedDocument {
  id            Int      @id @default(autoincrement())
  createdAt     DateTime @default(now())
  companyId     Int
  documentType  String
  templateId    Int?
  products      Json
  totalItems    Int
  sheetsPrinted Int?
  pdfFilePath   String?
  fileSizeBytes Int?
  generatedBy   Int
  generatedAt   DateTime @default(now())
  notes         String?
  Company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId, documentType, generatedAt])
  @@index([companyId])
}

model Ingredient {
  id                     Int                      @id @default(autoincrement())
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  name                   String
  supplier               String?
  packQuantity           Decimal
  packUnit               BaseUnit
  packPrice              Decimal
  currency               String                   @default("GBP")
  densityGPerMl          Decimal?
  notes                  String?
  companyId              Int?
  allergens              String[]                 @default([])
  lastPriceUpdate        DateTime                 @default(now())
  originalUnit           Unit?
  priceHistory           String?
  supplierId             Int?
  customConversions      String?
  batchPricing           Json?
  servingsPerPack        Int?
  servingUnit            String?
  Company                Company?                 @relation(fields: [companyId], references: [id])
  Supplier               Supplier?                @relation(fields: [supplierId], references: [id])
  IngredientPriceHistory IngredientPriceHistory[]
  RecipeItem             RecipeItem[]

  @@unique([name, companyId])
  @@index([companyId])
  @@index([companyId, lastPriceUpdate])
  @@index([companyId, name])
  @@index([supplierId])
}

model IngredientPriceHistory {
  id            Int        @id @default(autoincrement())
  createdAt     DateTime   @default(now())
  ingredientId  Int
  price         Decimal
  currency      String     @default("GBP")
  packQuantity  Decimal
  packUnit      String
  changeType    String
  previousPrice Decimal?
  supplierId    Int?
  supplierName  String?
  notes         String?
  source        String?
  Ingredient    Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([ingredientId, createdAt])
  @@index([ingredientId])
  @@index([supplierId])
}

model LabelTemplate {
  id                 Int      @id @default(autoincrement())
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  companyId          Int?
  templateName       String
  templateType       String   @default("custom")
  backgroundColor    String   @default("#E8E4DC")
  textColor          String   @default("#6D7C6F")
  accentColor        String?
  productFont        String   @default("Poppins")
  productFontWeight  String   @default("Bold")
  productFontSize    Int      @default(48)
  subtitleFont       String   @default("Poppins")
  subtitleFontWeight String   @default("SemiBold")
  subtitleFontSize   Int      @default(18)
  bodyFont           String   @default("Poppins")
  bodyFontWeight     String   @default("Regular")
  bodyFontSize       Int      @default(10)
  alignment          String   @default("center")
  textTransform      String   @default("uppercase")
  spacingStyle       String   @default("normal")
  marginMm           Decimal  @default(2.0)
  widthMm            Decimal  @default(65.0)
  heightMm           Decimal  @default(38.0)
  showPrice          Boolean  @default(true)
  showAllergens      Boolean  @default(true)
  showDietaryTags    Boolean  @default(true)
  showDate           Boolean  @default(true)
  showWeight         Boolean  @default(false)
  showCompanyName    Boolean  @default(false)
  showStorageInfo    Boolean  @default(false)
  showBarcode        Boolean  @default(false)
  isDefault          Boolean  @default(false)
  isSystemTemplate   Boolean  @default(false)
  createdBy          Int?
  Company            Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([companyId, isSystemTemplate])
}

model Membership {
  id               Int        @id @default(autoincrement())
  userId           Int
  companyId        Int
  acceptedAt       DateTime?
  createdAt        DateTime   @default(now())
  invitedAt        DateTime   @default(now())
  invitedBy        Int?
  isActive         Boolean    @default(true)
  pin              String?
  pinHash          String?
  updatedAt        DateTime   @default(now())
  role             MemberRole
  staffPermissions Json? // { canEditIngredients: boolean, canEditRecipes: boolean }
  Company          Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  User             User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyId])
  @@index([companyId])
  @@index([companyId, pin])
  @@index([userId])
}

model ProductionHistory {
  id               Int      @id @default(autoincrement())
  createdAt        DateTime @default(now())
  companyId        Int
  recipeId         Int
  productionDate   DateTime
  quantityProduced Decimal
  actualCost       Decimal?
  productionPlanId Int?
  batchNumber      String?
  wasteAmount      Decimal? @default(0)
  productionTime   Int?
  efficiency       Decimal?
  producedBy       Int?
  notes            String?
  metadata         Json?
  Company          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Recipe           Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([companyId, productionDate])
  @@index([productionDate])
  @@index([productionPlanId])
  @@index([recipeId])
}

model ProductionItem {
  id                       Int                        @id @default(autoincrement())
  createdAt                DateTime                   @default(now())
  planId                   Int
  recipeId                 Int
  customerId               Int?
  quantity                 Decimal
  priority                 Int                        @default(0)
  completed                Boolean                    @default(false)
  notes                    String?
  WholesaleCustomer        WholesaleCustomer?         @relation(fields: [customerId], references: [id])
  ProductionPlan           ProductionPlan             @relation(fields: [planId], references: [id], onDelete: Cascade)
  Recipe                   Recipe                     @relation(fields: [recipeId], references: [id])
  ProductionItemAllocation ProductionItemAllocation[]

  @@index([customerId])
  @@index([planId])
  @@index([recipeId])
}

model ProductionItemAllocation {
  id                Int                @id @default(autoincrement())
  createdAt         DateTime           @default(now())
  productionItemId  Int
  customerId        Int?
  destination       String
  quantity          Decimal
  notes             String?
  WholesaleCustomer WholesaleCustomer? @relation(fields: [customerId], references: [id])
  ProductionItem    ProductionItem     @relation(fields: [productionItemId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([productionItemId])
}

model ProductionPlan {
  id             Int              @id @default(autoincrement())
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  name           String
  startDate      DateTime
  endDate        DateTime
  notes          String?
  companyId      Int
  createdBy      Int
  ProductionItem ProductionItem[]
  Company        Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  ProductionTask ProductionTask[]

  @@index([companyId])
  @@index([startDate])
}

model ProductionTask {
  id             Int            @id @default(autoincrement())
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  planId         Int
  title          String
  description    String?
  assignedTo     Int?
  dueDate        DateTime?
  completed      Boolean        @default(false)
  priority       Int            @default(0)
  ProductionPlan ProductionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([assignedTo])
  @@index([planId])
}

model Recipe {
  id                                                     Int                  @id @default(autoincrement())
  createdAt                                              DateTime             @default(now())
  updatedAt                                              DateTime
  name                                                   String
  yieldQuantity                                          Decimal
  yieldUnit                                              BaseUnit
  imageUrl                                               String?
  companyId                                              Int?
  description                                            String?
  method                                                 String?
  actualFoodCost                                         Decimal?
  bakeTemp                                               Int?
  bakeTime                                               Int?
  category                                               String?
  categoryId                                             Int?
  isSubRecipe                                            Boolean              @default(false)
  lastPriceUpdate                                        DateTime?
  portionSize                                            Decimal?
  portionUnit                                            BaseUnit?
  portionsPerBatch                                       Int?
  sellingPrice                                           Decimal?
  shelfLife                                              String?
  shelfLifeId                                            Int?
  storage                                                String?
  storageId                                              Int?
  suggestedPrice                                         Decimal?
  wholesalePrice                                         Decimal?             @db.Decimal(10, 2)
  CustomerPricing                                        CustomerPricing[]
  ProductionHistory                                      ProductionHistory[]
  ProductionItem                                         ProductionItem[]
  Category                                               Category?            @relation(fields: [categoryId], references: [id])
  Company                                                Company?             @relation(fields: [companyId], references: [id])
  ShelfLifeOption                                        ShelfLifeOption?     @relation(fields: [shelfLifeId], references: [id])
  StorageOption                                          StorageOption?       @relation(fields: [storageId], references: [id])
  RecipeItem                                             RecipeItem[]
  RecipeSection                                          RecipeSection[]
  RecipeSubRecipe_RecipeSubRecipe_parentRecipeIdToRecipe RecipeSubRecipe[]    @relation("RecipeSubRecipe_parentRecipeIdToRecipe")
  RecipeSubRecipe_RecipeSubRecipe_subRecipeIdToRecipe    RecipeSubRecipe[]    @relation("RecipeSubRecipe_subRecipeIdToRecipe")
  RecipeUpdateLog                                        RecipeUpdateLog[]
  RecipeVersion                                          RecipeVersion[]
  SalesRecord                                            SalesRecord[]
  SeasonalTrend                                          SeasonalTrend[]
  WholesaleOrderItem                                     WholesaleOrderItem[]
  WholesaleProduct                                       WholesaleProduct[]

  @@unique([name, companyId])
  @@index([category])
  @@index([companyId, categoryId])
  @@index([companyId])
  @@index([companyId, name])
  @@index([companyId, updatedAt])
}

model RecipeItem {
  id            Int            @id @default(autoincrement())
  recipeId      Int
  ingredientId  Int
  quantity      Decimal
  unit          Unit
  note          String?
  sectionId     Int?
  price         Decimal?
  Ingredient    Ingredient     @relation(fields: [ingredientId], references: [id])
  Recipe        Recipe         @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  RecipeSection RecipeSection? @relation(fields: [sectionId], references: [id])

  @@index([ingredientId])
  @@index([recipeId])
  @@index([sectionId])
}

model RecipeSection {
  id          Int          @id @default(autoincrement())
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  recipeId    Int
  title       String
  description String?
  method      String?
  order       Int          @default(0)
  bakeTemp    Int?
  bakeTime    Int?
  hasTimer    Boolean      @default(false)
  RecipeItem  RecipeItem[]
  Recipe      Recipe       @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId])
  @@index([recipeId, order])
}

model RecipeSubRecipe {
  id                                            Int      @id @default(autoincrement())
  createdAt                                     DateTime @default(now())
  updatedAt                                     DateTime
  parentRecipeId                                Int
  subRecipeId                                   Int
  quantity                                      Decimal
  unit                                          Unit
  note                                          String?
  Recipe_RecipeSubRecipe_parentRecipeIdToRecipe Recipe   @relation("RecipeSubRecipe_parentRecipeIdToRecipe", fields: [parentRecipeId], references: [id], onDelete: Cascade)
  Recipe_RecipeSubRecipe_subRecipeIdToRecipe    Recipe   @relation("RecipeSubRecipe_subRecipeIdToRecipe", fields: [subRecipeId], references: [id], onDelete: Cascade)

  @@unique([parentRecipeId, subRecipeId])
  @@index([parentRecipeId])
  @@index([subRecipeId])
}

model RecipeUpdateLog {
  id             Int      @id @default(autoincrement())
  createdAt      DateTime @default(now())
  recipeId       Int
  companyId      Int
  updateType     String
  changedField   String?
  oldValue       String?
  newValue       String?
  allergenImpact Boolean  @default(false)
  updatedBy      Int?
  updatedAt      DateTime @default(now())
  Company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Recipe         Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([companyId, allergenImpact, updatedAt])
  @@index([companyId])
  @@index([recipeId])
}

model RecipeVersion {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now())
  recipeId     Int
  version      Int
  snapshot     Json
  changedBy    Int
  changeNote   String?
  totalCost    Decimal?
  sellingPrice Decimal?
  foodCostPct  Decimal?
  Recipe       Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@unique([recipeId, version])
  @@index([recipeId])
  @@index([recipeId, version])
}

model SalesRecord {
  id              Int      @id @default(autoincrement())
  createdAt       DateTime @default(now())
  companyId       Int
  transactionDate DateTime
  channel         String
  recipeId        Int?
  productName     String?
  quantity        Decimal
  unitPrice       Decimal
  totalRevenue    Decimal
  customerId      Int?
  customerName    String?
  orderId         Int?
  notes           String?
  externalId      String?
  externalSource  String?
  Company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Recipe          Recipe?  @relation(fields: [recipeId], references: [id])

  @@index([channel])
  @@index([companyId])
  @@index([companyId, transactionDate])
  @@index([externalId])
  @@index([recipeId])
  @@index([transactionDate])
}

model SeasonalTrend {
  id               Int      @id @default(autoincrement())
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  companyId        Int
  recipeId         Int?
  category         String?
  season           String
  month            Int?
  demandMultiplier Decimal
  confidence       Decimal
  dataPoints       Int
  description      String?
  notes            String?
  isActive         Boolean  @default(true)
  Company          Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Recipe           Recipe?  @relation(fields: [recipeId], references: [id])

  @@unique([companyId, recipeId, season])
  @@index([category])
  @@index([companyId])
  @@index([recipeId])
  @@index([season])
}

model Session {
  id           String    @id
  userId       Int
  token        String    @unique
  refreshToken String?   @unique
  deviceInfo   String?
  ipAddress    String?
  userAgent    String?
  expiresAt    DateTime
  createdAt    DateTime  @default(now())
  revokedAt    DateTime?
  lastUsedAt   DateTime  @default(now())
  User         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([refreshToken])
  @@index([token])
  @@index([userId])
  @@index([userId, revokedAt])
}

model ShelfLifeOption {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  name        String
  description String?
  order       Int      @default(0)
  companyId   Int?
  Recipe      Recipe[]
  Company     Company? @relation(fields: [companyId], references: [id])

  @@unique([name, companyId])
  @@index([companyId])
  @@index([companyId, order])
}

model StorageOption {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  name        String
  description String?
  icon        String?
  order       Int      @default(0)
  companyId   Int?
  Recipe      Recipe[]
  Company     Company? @relation(fields: [companyId], references: [id])

  @@unique([name, companyId])
  @@index([companyId])
  @@index([companyId, order])
}

model Subscription {
  id                   Int       @id @default(autoincrement())
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  userId               Int       @unique
  stripeSubscriptionId String?   @unique
  stripePriceId        String?
  stripeProductId      String?
  status               String    @default("free")
  tier                 String    @default("free")
  price                Decimal   @default(0)
  currency             String    @default("GBP")
  interval             String    @default("month")
  currentPeriodStart   DateTime?
  currentPeriodEnd     DateTime?
  cancelAtPeriodEnd    Boolean   @default(false)
  canceledAt           DateTime?
  User                 User      @relation(fields: [userId], references: [id])
}

model Supplier {
  id              Int          @id @default(autoincrement())
  createdAt       DateTime     @default(now())
  updatedAt       DateTime
  name            String
  description     String?
  contactName     String?
  email           String?
  phone           String?
  website         String?
  deliveryDays    String[]     @default([])
  deliveryNotes   String?
  accountLogin    String?
  accountPassword String?
  accountNumber   String?
  address         String?
  city            String?
  postcode        String?
  country         String?
  currency        String?      @default("GBP")
  paymentTerms    String?
  minimumOrder    Decimal?
  companyId       Int?
  Ingredient      Ingredient[]
  Company         Company?     @relation(fields: [companyId], references: [id])

  @@unique([name, companyId])
  @@index([companyId])
}

model TeamInvitation {
  id         Int        @id @default(autoincrement())
  createdAt  DateTime   @default(now())
  updatedAt  DateTime
  companyId  Int
  email      String
  role       MemberRole
  invitedBy  Int
  token      String     @unique
  acceptedAt DateTime?
  expiresAt  DateTime
  Company    Company    @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, email])
  @@index([companyId])
  @@index([email])
}

model User {
  id                          Int                @id @default(autoincrement())
  createdAt                   DateTime           @default(now())
  updatedAt                   DateTime
  email                       String             @unique
  name                        String?
  passwordHash                String?
  hasCompletedOnboarding      Boolean            @default(false)
  ingredientCount             Int                @default(0)
  isActive                    Boolean            @default(true)
  lastLoginAt                 DateTime?
  recipeCount                 Int                @default(0)
  stripeCustomerId            String?            @unique
  subscriptionEndsAt          DateTime?
  subscriptionInterval        String             @default("month")
  subscriptionStatus          String             @default("free")
  subscriptionTier            String             @default("free")
  emailVerified               Boolean            @default(false)
  verificationToken           String?            @unique
  verificationTokenExpiresAt  DateTime?
  resetPasswordToken          String?            @unique
  resetPasswordTokenExpiresAt DateTime?
  ActivityLog                 ActivityLog[]
  Membership                  Membership[]
  Session                     Session[]
  Subscription                Subscription?
  UserPreference              UserPreference?
  WholesalePayment            WholesalePayment[]
}

model UserPreference {
  id              Int     @id @default(autoincrement())
  userId          Int     @unique
  currency        String  @default("GBP")
  maxFoodCost     Decimal @default(35.0)
  navigationItems Json?
  targetFoodCost  Decimal @default(25.0)
  timerSettings   Json?
  User            User    @relation(fields: [userId], references: [id])
}

model WholesaleCustomer {
  id                       Int                        @id @default(autoincrement())
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  companyId                Int
  name                     String
  contactName              String?
  email                    String?
  phone                    String?
  address                  String?
  city                     String?
  postcode                 String?
  country                  String?
  notes                    String?
  isActive                 Boolean                    @default(true)
  portalToken              String?                    @unique
  portalShortCode          String?                    @unique
  portalEnabled            Boolean                    @default(false)
  openingHours             Json?
  deliveryDays             String[]
  preferredDeliveryTime    String?
  paymentTerms             String?
  creditLimit              Decimal?                   @db.Decimal(10, 2)
  taxId                    String?
  accountManager           String?
  specialInstructions      String?
  orderFrequency           String?
  lastOrderDate            DateTime?
  totalOrders              Int?                       @default(0)
  totalValue               Decimal?                   @default(0) @db.Decimal(10, 2)
  totalPaid                Decimal?                   @default(0) @db.Decimal(10, 2)
  outstandingBalance       Decimal?                   @default(0) @db.Decimal(10, 2)
  customerType             String?                    @default("wholesale")
  CustomerPricing          CustomerPricing[]
  ProductionItem           ProductionItem[]
  ProductionItemAllocation ProductionItemAllocation[]
  Company                  Company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  WholesaleDeliveryNote    WholesaleDeliveryNote[]
  WholesaleInvoice         WholesaleInvoice[]
  WholesaleOrder           WholesaleOrder[]
  WholesalePayment         WholesalePayment[]

  @@index([companyId])
  @@index([deliveryDays], type: Gin)
  @@index([isActive])
  @@index([portalToken])
}

model WholesaleDeliveryNote {
  id                 Int               @id @default(autoincrement())
  createdAt          DateTime          @default(now())
  updatedAt          DateTime
  deliveryNoteNumber String            @unique
  orderId            Int
  customerId         Int
  companyId          Int
  deliveryDate       DateTime
  deliveredBy        String?
  signature          String?
  notes              String?
  pdfUrl             String?
  emailSent          Boolean?          @default(false)
  emailSentAt        DateTime?
  Company            Company           @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  WholesaleCustomer  WholesaleCustomer @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  WholesaleOrder     WholesaleOrder    @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([companyId])
  @@index([customerId])
  @@index([orderId])
}

model WholesaleInvoice {
  id                Int                @id @default(autoincrement())
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  invoiceNumber     String             @unique
  orderId           Int?
  customerId        Int
  companyId         Int
  issueDate         DateTime           @default(now())
  dueDate           DateTime
  subtotal          Decimal            @db.Decimal(10, 2)
  taxRate           Decimal?           @default(0) @db.Decimal(5, 2)
  taxAmount         Decimal?           @default(0) @db.Decimal(10, 2)
  total             Decimal            @db.Decimal(10, 2)
  status            String             @default("draft")
  paidDate          DateTime?
  paidAmount        Decimal?           @db.Decimal(10, 2)
  notes             String?
  pdfUrl            String?
  emailSent         Boolean?           @default(false)
  emailSentAt       DateTime?
  Company           Company            @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  WholesaleCustomer WholesaleCustomer  @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  WholesaleOrder    WholesaleOrder?    @relation(fields: [orderId], references: [id], onUpdate: NoAction)
  WholesalePayment  WholesalePayment[]

  @@index([companyId])
  @@index([customerId])
  @@index([dueDate])
  @@index([invoiceNumber])
  @@index([orderId])
  @@index([status])
}

model WholesaleOrder {
  id                    Int                     @id @default(autoincrement())
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  customerId            Int
  companyId             Int
  orderNumber           String?
  deliveryDate          DateTime?
  status                String                  @default("pending")
  notes                 String?
  isRecurring           Boolean                 @default(false)
  recurringInterval     String?
  recurringIntervalDays Int?
  recurringEndDate      DateTime?
  nextRecurrenceDate    DateTime?
  recurringStatus       String?
  parentOrderId         Int?
  WholesaleDeliveryNote WholesaleDeliveryNote[]
  WholesaleInvoice      WholesaleInvoice[]
  Company               Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  WholesaleCustomer     WholesaleCustomer       @relation(fields: [customerId], references: [id], onDelete: Cascade)
  WholesaleOrder        WholesaleOrder?         @relation("WholesaleOrderToWholesaleOrder", fields: [parentOrderId], references: [id])
  other_WholesaleOrder  WholesaleOrder[]        @relation("WholesaleOrderToWholesaleOrder")
  WholesaleOrderItem    WholesaleOrderItem[]

  @@index([companyId])
  @@index([customerId])
  @@index([deliveryDate])
  @@index([isRecurring])
  @@index([nextRecurrenceDate])
  @@index([parentOrderId])
  @@index([recurringStatus])
  @@index([status])
}

model WholesaleOrderItem {
  id             Int            @id @default(autoincrement())
  orderId        Int
  recipeId       Int
  quantity       Int
  price          Decimal?
  notes          String?
  WholesaleOrder WholesaleOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  Recipe         Recipe         @relation(fields: [recipeId], references: [id])

  @@index([orderId])
  @@index([recipeId])
}

model WholesalePayment {
  id                Int               @id @default(autoincrement())
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  invoiceId         Int
  customerId        Int
  companyId         Int
  amount            Decimal           @db.Decimal(10, 2)
  paymentDate       DateTime          @default(now())
  paymentMethod     String
  reference         String?
  notes             String?
  createdBy         Int
  Company           Company           @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  User              User              @relation(fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  WholesaleCustomer WholesaleCustomer @relation(fields: [customerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  WholesaleInvoice  WholesaleInvoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([companyId])
  @@index([customerId])
  @@index([invoiceId])
  @@index([paymentDate])
}

model WholesaleProduct {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  companyId   Int
  recipeId    Int?
  name        String?
  description String?
  unit        String?
  price       Decimal
  currency    String   @default("GBP")
  category    String?
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  imageUrl    String?
  notes       String?
  Company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Recipe      Recipe?  @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([companyId])
  @@index([companyId, isActive])
  @@index([isActive])
  @@index([recipeId])
}

enum BaseUnit {
  g
  ml
  each
  slices
}

enum MemberRole {
  ADMIN
  MANAGER
  STAFF
}

enum Unit {
  g
  kg
  mg
  lb
  oz
  ml
  l
  pint
  quart
  gallon
  tsp
  tbsp
  cup
  floz
  each
  slices
  pinch
  dash
  large
  medium
  small
}
